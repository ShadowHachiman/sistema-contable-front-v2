<div class="reports-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <mat-icon color="primary">assessment</mat-icon> Reportes Contables
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <mat-tab-group animationDuration="0ms">

        <mat-tab label="Balance de Comprobación">
          <div class="report-content">
            <h3>Balance de Sumas y Saldos</h3>

            <table mat-table [dataSource]="balanceReportData" class="full-width">

              <ng-container matColumnDef="accountCode">
                <th mat-header-cell *matHeaderCellDef> Código </th>
                <td mat-cell *matCellDef="let item"> {{ item.accountCode }} </td>
                <td mat-footer-cell *matFooterCellDef> **Totales** </td>
              </ng-container>

              <ng-container matColumnDef="accountName">
                <th mat-header-cell *matHeaderCellDef> Cuenta </th>
                <td mat-cell *matCellDef="let item"> {{ item.accountName }} </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>

              <ng-container matColumnDef="debit">
                <th mat-header-cell *matHeaderCellDef> Suma Debe </th>
                <td mat-cell *matCellDef="let item" class="currency-cell"> {{ item.debit | number:'1.2-2' }} </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>

              <ng-container matColumnDef="credit">
                <th mat-header-cell *matHeaderCellDef> Suma Haber </th>
                <td mat-cell *matCellDef="let item" class="currency-cell"> {{ item.credit | number:'1.2-2' }} </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>

              <ng-container matColumnDef="balanceDebit">
                <th mat-header-cell *matHeaderCellDef> Saldo Deudor </th>
                <td mat-cell *matCellDef="let item" class="currency-cell"> {{ item.balanceDebit | number:'1.2-2' }} </td>
                <td mat-footer-cell *matFooterCellDef class="currency-cell"> {{ totalBalanceDebit | number:'1.2-2' }} </td>
              </ng-container>

              <ng-container matColumnDef="balanceCredit">
                <th mat-header-cell *matHeaderCellDef> Saldo Acreedor </th>
                <td mat-cell *matCellDef="let item" class="currency-cell"> {{ item.balanceCredit | number:'1.2-2' }} </td>
                <td mat-footer-cell *matFooterCellDef class="currency-cell"> {{ totalBalanceCredit | number:'1.2-2' }} </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="balanceColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: balanceColumns;"></tr>
              <tr mat-footer-row *matFooterRowDef="balanceColumns"></tr>
            </table>

            <div *ngIf="balanceReportData.length === 0" class="no-data-message">
              No hay datos para generar el Balance de Comprobación.
            </div>
          </div>
        </mat-tab>

        <mat-tab label="Libro Mayor">
          <div class="report-content">
            <h3>Libro Mayor (Movimientos Detallados)</h3>

            <form [formGroup]="ledgerForm" (ngSubmit)="loadLedgerReport()" class="ledger-form">
              <mat-form-field appearance="outline" class="account-selector">
                <mat-label>Seleccionar Cuenta</mat-label>
                <mat-select formControlName="accountId" required>
                  <mat-option *ngFor="let acc of accounts$ | async" [value]="acc.id">
                    ({{ acc.code }}) {{ acc.name }}
                  </mat-option>
                </mat-select>
                <mat-error>Seleccione una cuenta.</mat-error>
              </mat-form-field>

              <button mat-raised-button color="primary" [disabled]="ledgerForm.invalid" type="submit">
                <mat-icon>search</mat-icon> Generar Mayor
              </button>
            </form>

            <table mat-table [dataSource]="ledgerReportData" class="full-width mt-20">

              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef> Fecha </th>
                <td mat-cell *matCellDef="let item"> {{ item.date | date:'dd/MM/yyyy' }} </td>
              </ng-container>

              <ng-container matColumnDef="journalEntryId">
                <th mat-header-cell *matHeaderCellDef> Asiento # </th>
                <td mat-cell *matCellDef="let item"> {{ item.journalEntryId }} </td>
              </ng-container>

              <ng-container matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef> Detalle </th>
                <td mat-cell *matCellDef="let item"> {{ item.description }} </td>
              </ng-container>

              <ng-container matColumnDef="debit">
                <th mat-header-cell *matHeaderCellDef> Debe </th>
                <td mat-cell *matCellDef="let item" class="currency-cell"> {{ item.debit | number:'1.2-2' }} </td>
              </ng-container>

              <ng-container matColumnDef="credit">
                <th mat-header-cell *matHeaderCellDef> Haber </th>
                <td mat-cell *matCellDef="let item" class="currency-cell"> {{ item.credit | number:'1.2-2' }} </td>
              </ng-container>

              <ng-container matColumnDef="runningBalance">
                <th mat-header-cell *matHeaderCellDef> Saldo </th>
                <td mat-cell *matCellDef="let item" class="currency-cell balance-highlight">
                  {{ item.runningBalance | number:'1.2-2' }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="ledgerColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: ledgerColumns;"></tr>
            </table>

            <div *ngIf="ledgerReportData.length === 0 && ledgerForm.get('accountId')?.valid" class="no-data-message mt-20">
              No se encontraron movimientos para esta cuenta.
            </div>
          </div>
        </mat-tab>

      </mat-tab-group>
    </mat-card-content>
  </mat-card>
</div>
